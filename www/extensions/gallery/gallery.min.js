/*!
 *	GALLERY
 *	Extension for the Automad CMS
 *
 *	Copyright (c) 2014 by Marc Anton Dahmen
 *	http://marcdahmen.de
 *
 *	Licensed under the MIT license.
 */
(function($){$.fn.Gallery=function(){var images=$(this);if(images.length>0){var slideshow=$('<div id="gallerySlideshow"></div>').appendTo("body").hide(),overlay=$('<div class="overlay"></div>').appendTo(slideshow).fadeTo(0,0.9),caption=$('<div class="caption"></div>').appendTo(slideshow),captionText=$('<h2 class="captionText"></h2>').appendTo(caption),close=$('<a class="closeSlideshow" href="#"></a>').appendTo(slideshow),prev=$('<a class="prevImage" href="#"><</a>').appendTo(slideshow),next=$('<a class="nextImage" href="#">></a>').appendTo(slideshow),isVisible=false,smallWidth,smallHeight,smallPos,origWidth,origHeight,current;displayCaption=function(txt){if(txt!=""){captionText.text(txt);caption.fadeIn(300)}};close.click(function(){slideshow.fadeOut(500,function(){bigImage.remove()});isVisible=false;return false});prev.click(function(){if(current>0){current-=1}else{current=images.length-1}changeImage(current);return false});next.click(function(){if(images.length>(current+1)){current+=1}else{current=0}changeImage(current);return false});var setImageSizeAndFadeIn=function(){var bigWidth=bigImage.width(),bigHeight=bigImage.height(),screenRatio=slideshow.height()/slideshow.width(),bigRatio=bigHeight/bigWidth;if((origWidth>slideshow.width())||(origHeight>slideshow.height())){if(screenRatio>bigRatio){bigWidth=slideshow.width();bigHeight=bigWidth*bigRatio}else{bigHeight=slideshow.height();bigWidth=bigHeight/bigRatio}}if((slideshow.height()-bigHeight)!=0){bigTop=((slideshow.height()-bigHeight)/2)+"px"}else{bigTop=0}if((slideshow.width()-bigWidth)!=0){bigLeft=((slideshow.width()-bigWidth)/2)+"px"}else{bigLeft=0}if(isVisible){bigImage.css({width:bigWidth+"px",height:bigHeight+"px",top:bigTop,left:bigLeft});bigImage.fadeIn(300)}else{bigImage.width(smallWidth);bigImage.height(smallHeight);bigImage.offset({top:smallPos.top,left:smallPos.left});bigImage.fadeIn(200).animate({width:bigWidth+"px",height:bigHeight+"px",top:bigTop,left:bigLeft},300)}};images.each(function(i){var $this=$(this),url=$this.attr("href"),title=$this.find("img").attr("title");$this.click(function(){current=i;smallWidth=$this.width();smallHeight=$this.height();smallPos=$this.offset();bigImage=$('<img alt="">').appendTo(slideshow).hide().one("load",function(){origWidth=bigImage.width();origHeight=bigImage.height();setImageSizeAndFadeIn();displayCaption(title);isVisible=true}).attr("src",url);slideshow.fadeIn(500);return false})});var changeImage=function(i){var url=images.eq(i).attr("href"),title=images.eq(i).find("img").attr("title");bigImage.fadeOut(200);caption.fadeOut(200);setTimeout(function(){bigImage.remove();bigImage=$('<img alt="">').appendTo(slideshow).hide().one("load",function(){origWidth=bigImage.width();origHeight=bigImage.height();setImageSizeAndFadeIn();displayCaption(title)}).attr("src",url)},200)};$(window).resize(function(){if(isVisible){setImageSizeAndFadeIn()}})}}})(jQuery);$(document).ready(function(){$(".gallery a").Gallery()});