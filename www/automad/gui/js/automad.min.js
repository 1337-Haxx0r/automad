/*!
 *	                  ....
 *	                .:   '':.
 *	                ::::     ':..
 *	                ::.         ''..
 *	     .:'.. ..':.:::'    . :.   '':.
 *	    :.   ''     ''     '. ::::.. ..:
 *	    ::::.        ..':.. .''':::::  .
 *	    :::::::..    '..::::  :. ::::  :
 *	    ::'':::::::.    ':::.'':.::::  :
 *	    :..   ''::::::....':     ''::  :
 *	    :::::.    ':::::   :     .. '' .
 *	 .''::::::::... ':::.''   ..''  :.''''.
 *	 :..:::'':::::  :::::...:''        :..:
 *	 ::::::. '::::  ::::::::  ..::        .
 *	 ::::::::.::::  ::::::::  :'':.::   .''
 *	 ::: '::::::::.' '':::::  :.' '':  :
 *	 :::   :::::::::..' ::::  ::...'   .
 *	 :::  .::::::::::   ::::  ::::  .:'
 *	  '::'  '':::::::   ::::  : ::  :
 *	            '::::   ::::  :''  .:
 *	             ::::   ::::    ..''
 *	             :::: ..:::: .:''
 *	               ''''  '''''
 *	
 *
 *	AUTOMAD CMS
 *
 *	Copyright (c) 2014 by Marc Anton Dahmen
 *	http://marcdahmen.de
 *
 *	Licensed under the MIT license.
 */
$(document).on("click","#automad-add-variable-button",function(){var idPrefix="input-data-",name=$("#automad-add-variable-name").val().replace(/[^\w]/g,"_").toLowerCase();if($("#"+idPrefix+name).length==0){if(name){var newFormGroup=$('<div class="form-group"><label for="'+idPrefix+name+'" class="text-muted">'+name.charAt(0).toUpperCase()+name.slice(1)+'</label><button type="button" class="close automad-remove-parent">&times;</button><textarea id="'+idPrefix+name+'" class="form-control input-sm" name="data['+name+']" rows="10"></textarea></div>').appendTo($("#automad-custom-variables"));$("#automad-add-variable-modal").modal("hide");$("#automad-add-variable-name").val("");newFormGroup.find("textarea").trigger("keyup")}else{$('<div class="alert alert-danger"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+$(this).data("automadErrorName")+"</div>").prependTo($("#automad-add-variable-modal .modal-body"))}}else{$('<div class="alert alert-danger"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+$(this).data("automadErrorExists")+"</div>").prependTo($("#automad-add-variable-modal .modal-body"))}});$(document).on("click","#automad-move-page-modal a",function(){var modal=$("#automad-move-page-modal"),modalBody=modal.find(".modal-body"),url=modal.data("automadUrl"),title=modal.data("automadTitle"),destination=decodeURIComponent($(this).attr("href").split("=")[1]);$.post("?ajax=move_page",{url:url,title:title,destination:destination},function(data){console.log(data);if(data.redirect){window.location.href=data.redirect}if(data.error){$('<div class="alert alert-danger alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+data.error+"</div>").prependTo(modalBody)}},"json");return false});$(document).on("click",".automad-remove-parent",function(){$(this).parent().remove()});$(document).on("submit",".automad-form",function(e){e.preventDefault();var form=$(this),btn=form.find('button[type="submit"]'),handler=form.data("automadHandler"),url=form.data("automadUrl"),param=form.serializeArray();if(url){param.push({name:"url",value:url})}btn.button("loading");$.post("?ajax="+handler,param,function(data){form.parent().find(".alert").remove();if(data.debug){console.log(data.debug)}if(data.redirect){window.location.href=data.redirect}if(data.html){form.html(data.html)}if(data.error){if(form.parents(".modal-dialog").length!==0){$('<div class="alert alert-danger alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+data.error+"</div>").prependTo(form.find(".modal-body"))}else{$('<div class="alert alert-danger alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+data.error+"</div>").insertBefore(form)}}if(data.success){if(form.parents(".modal-dialog").length!==0){$('<div class="alert alert-success alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+data.success+"</div>").prependTo(form.find(".modal-body"))}else{$('<div class="alert alert-success alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+data.success+"</div>").insertBefore(form)}}if(!data.error){form.closest(".automad-close-on-success").modal("hide");form.filter(".automad-reset").each(function(){this.reset()})}btn.button("reset")},"json")});$(document).ajaxComplete(function(){setTimeout(function(){$('#data [type="submit"], #files [type="submit"], #users [type="submit"]').prop("disabled",true)},100)});$(document).on("change click","#data input, #data textarea, #data select, #data button",function(){$('#data [type="submit"]').prop("disabled",false)});$(document).on("change","#files input, #users input",function(){$('#files [type="submit"], #users [type="submit"]').prop("disabled",false)});$(document).ready(function(){$(".automad-init").trigger("submit");$(".modal").on("show.bs.modal",function(e){$(this).find(".automad-init").submit()})});function getStatus(){$(".automad-status").each(function(){var container=$(this),item=container.data("automadStatus");$.post("?ajax=status",{item:item},function(data){container.html(data.status)},"json")})}$(document).ready(function(){getStatus()});$(document).ajaxComplete(function(e,xhr,settings){if(settings.url!="?ajax=status"){getStatus()}});$(document).on("keyup","textarea:visible",function(){var ta=$(this),content=ta.val().replace(/\n/g,"<br />"),clone=$("<div></div>").appendTo("body").hide().width(ta.width()).html(content+" ").css({"white-space":"pre-wrap","word-wrap":"break-word","overflow-wrap":"break-word","font-family":ta.css("font-family"),"font-size":ta.css("font-size"),"line-height":ta.css("line-height"),"letter-spacing":ta.css("letter-spacing")});ta.css({resize:"none",overflow:"hidden"}).height(clone.height()+20);clone.remove()});$(document).ajaxComplete(function(){$("textarea").trigger("keyup")});$(document).on("click",'[data-target="#automad-upload-modal"]',function(){var modal=$($(this).data("target")),url=modal.data("automadUrl"),dropzoneText=modal.data("automadDropzoneText"),browseText=modal.data("automadBrowseText"),uploader=modal.find("#automad-upload").html(""),dropzone=$('<div class="well well-lg"><h2 class="center-block text-muted" style="text-align: center;">'+dropzoneText+"</h2></div>").appendTo(uploader),input=$('<input type="file" multiple />').appendTo(dropzone).hide(),browse=$('<button class="btn btn-default center-block">'+browseText+"</button>").click(function(){input.click();return false}).appendTo(dropzone),close=modal.find('[data-dismiss="modal"]');$(document).on("drop dragover",function(e){e.preventDefault()});function fileSize(bytes){if(typeof bytes!=="number"){return""}if(bytes>=1000000000){return(bytes/1000000000).toFixed(2)+" gb"}if(bytes>=1000000){return(bytes/1000000).toFixed(2)+" mb"}return(bytes/1000).toFixed(2)+" kb"}input.fileupload({url:"?ajax=upload",dataType:"json",dropZone:dropzone,sequentialUploads:true,singleFileUploads:true,formData:[{name:"url",value:url}],add:function(e,data){var text="";$.each(data.files,function(i){text=text+'<h5><span class="label label-default">'+fileSize(data.files[i].size)+"</span> "+data.files[i].name+"</h5>"});data.context=$('<div class="file"></div>').appendTo(uploader);$(text).appendTo(data.context);$('<div class="progress progress-striped active"><div class="progress-bar"></div></div>').appendTo(data.context);data.context.find(".progress-bar").width("0px");data.submit();close.button("loading")},progress:function(e,data){var progress=parseInt(data.loaded/data.total*100,10);data.context.find(".progress-bar").text(progress+" %").animate({width:progress+"%"},120)},always:function(e,data){if(data.dataType.indexOf("iframe")<0){if(input.fileupload("active")<=1){close.button("reset")}}else{close.button("reset")}console.log(data.result)},done:function(e,data){if(data.result.error){data.context.find(".progress-bar").addClass("progress-bar-warning");data.context.find(".progress").after('<div class="alert alert-warning">'+data.result.error+"</div>")}else{data.context.find(".progress-bar").addClass("progress-bar-success")}data.context.find(".progress").removeClass("progress-striped active")},fail:function(e,data){data.context.find(".progress-bar").text("Error").addClass("progress-bar-danger")}});modal.on("hidden.bs.modal",function(e){modal.closest("form").submit()});modal.modal({show:true,backdrop:"static",keyboard:false})});$(document).ready(function(){$("#noscript").remove();$("#script").show()});