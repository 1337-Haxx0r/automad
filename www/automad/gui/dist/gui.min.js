/*
 *	                  ....
 *	                .:   '':.
 *	                ::::     ':..
 *	                ::.         ''..
 *	     .:'.. ..':.:::'    . :.   '':.
 *	    :.   ''     ''     '. ::::.. ..:
 *	    ::::.        ..':.. .''':::::  .
 *	    :::::::..    '..::::  :. ::::  :
 *	    ::'':::::::.    ':::.'':.::::  :
 *	    :..   ''::::::....':     ''::  :
 *	    :::::.    ':::::   :     .. '' .
 *	 .''::::::::... ':::.''   ..''  :.''''.
 *	 :..:::'':::::  :::::...:''        :..:
 *	 ::::::. '::::  ::::::::  ..::        .
 *	 ::::::::.::::  ::::::::  :'':.::   .''
 *	 ::: '::::::::.' '':::::  :.' '':  :
 *	 :::   :::::::::..' ::::  ::...'   .
 *	 :::  .::::::::::   ::::  ::::  .:'
 *	  '::'  '':::::::   ::::  : ::  :
 *	            '::::   ::::  :''  .:
 *	             ::::   ::::    ..''
 *	             :::: ..:::: .:''
 *	               ''''  '''''
 *	
 *
 *	AUTOMAD GUI 
 *	
 *	version 16.04.10
 *
 *	Copyright (c) 2014-2016 by Marc Anton Dahmen
 *	http://marcdahmen.de
 *
 *	Licensed under the MIT license.
 *	http://automad.org/license
 */$(document).on("click","#automad-add-variable-button",function(){var t="input-data-",e=$("#automad-add-variable-name").val().replace(/[^\w\.\-]/g,"_").toLowerCase();if(0==$("#"+t+e).length)if(e){var a=$('<div class="form-group"><label for="'+t+e+'">'+e.charAt(0).toUpperCase()+e.slice(1)+'</label><button type="button" class="close automad-remove-parent">&times;</button><textarea id="'+t+e+'" class="form-control" name="data['+e+']" rows="10"></textarea></div>').appendTo($("#automad-custom-variables"));$("#automad-add-variable-modal").modal("hide"),$("#automad-add-variable-name").val(""),a.find("textarea").trigger("keyup")}else $('<div class="alert alert-danger"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+$(this).data("automadErrorName")+"</div>").prependTo($("#automad-add-variable-modal .modal-body"));else $('<div class="alert alert-danger"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+$(this).data("automadErrorExists")+"</div>").prependTo($("#automad-add-variable-modal .modal-body"))}),$(document).on("submit",".automad-form",function(t){t.preventDefault();var e=$(this),a=e.find('button[type="submit"]'),o=e.data("automadHandler"),n=e.data("automadUrl"),i=e.serializeArray();n&&i.push({name:"url",value:n}),a.button("loading"),$.post("?ajax="+o,i,function(t){e.parent().find(".alert").remove(),t.redirect&&(window.location.href=t.redirect),t.html&&e.html(t.html),t.error&&(0!==e.parents(".modal-dialog").length?$('<div class="alert alert-danger alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+t.error+"</div>").prependTo(e.find(".modal-body")):$('<div class="alert alert-danger alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+t.error+"</div>").prependTo(e)),t.success&&(0!==e.parents(".modal-dialog").length?$('<div class="alert alert-success alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+t.success+"</div>").prependTo(e.find(".modal-body")):$('<div class="alert alert-success alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+t.success+"</div>").prependTo(e)),t.error||(e.closest(".automad-close-on-success").modal("hide"),e.filter(".automad-reset").each(function(){this.reset()})),a.button("reset")},"json")}),$(document).ajaxComplete(function(){setTimeout(function(){$('#data [type="submit"], #files [type="submit"], #users [type="submit"]').prop("disabled",!0)},100)}),$(document).on("change click drop","#data input, #data textarea, #data select, #data button",function(){$('#data [type="submit"]').prop("disabled",!1)}),$(document).on("change","#files .box input, #users input",function(){$('#files [type="submit"], #users [type="submit"]').prop("disabled",!1)}),$(document).ready(function(){$(".automad-init").trigger("submit"),$(".modal").on("show.bs.modal",function(t){$(this).find(".automad-init").submit()})}),$(document).ready(function(){$("#noscript").remove(),$("#script").removeClass("hidden")}),$(document).on("click","#automad-move-page-modal a",function(){var t=$("#automad-move-page-modal"),e=t.find(".modal-body"),a=t.data("automadUrl"),o=t.data("automadTitle"),n=decodeURIComponent($(this).attr("href").split("=")[1]);return $.post("?ajax=move_page",{url:a,title:o,destination:n},function(t){t.redirect&&(window.location.href=t.redirect),t.error&&$('<div class="alert alert-danger alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+t.error+"</div>").prependTo(e)},"json"),!1}),$(document).on("click",".automad-remove-parent",function(){$(this).parent().remove()}),$(document).on("click",'[data-target="#automad-rename-file-modal"]',function(){var t=$("#automad-rename-file-modal"),e=t.find(".modal-body").empty();$("<input>",{type:"hidden",name:"old-name"}).val($(this).data("file")).appendTo(e),$("<input>",{type:"text",name:"new-name","class":"form-control"}).val($(this).data("file")).appendTo(e);t.on("hidden.bs.modal",function(){var a=t.closest("form");e.empty(),a.get(0).reset(),a.submit()})}),$(document).on("click","button#rename-file",function(){var t=$(this).button("loading"),e=$("#automad-rename-file-modal"),a={url:e.data("automadUrl"),"old-name":e.find('[name="old-name"]').val(),"new-name":e.find('[name="new-name"]').val()};$.post("?ajax=rename_file",a,function(a){t.button("reset"),a.error?(e.find(".alert").remove(),$('<div class="alert alert-danger alert-dismissable fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+a.error+"</div>").prependTo(e.find(".modal-body"))):e.modal("hide")},"json")}),$(document).ready(function(){$(".scroll").mCustomScrollbar({scrollbarPosition:"outside",theme:"minimal-dark",autoHideScrollbar:!0,scrollInertia:300,scrollButtons:{enable:!1}}),setTimeout(function(){var t=$(".column.nav li.active");t.offset().top+80>$(window).height()&&$(".column.nav .scroll").mCustomScrollbar("scrollTo",function(){return t.offset().top-$(window).height()+80},{scrollInertia:150})},100)}),$(document).ready(function(){var t=$(".column.nav .pages");t.find("li li").has("ul").each(function(){var t=$(this),e=t.children("ul"),a=$('<a href="#" class="expand"><span class="glyphicon"></span></a>').prependTo(t);t.hasClass("active")||t.find(".active").length>0?a.children(".glyphicon").addClass("glyphicon-minus-sign"):(a.children(".glyphicon").addClass("glyphicon-plus-sign"),e.hide()),a.click(function(t){t.preventDefault(),e.toggle(),a.children(".glyphicon").toggleClass("glyphicon-plus-sign glyphicon-minus-sign")})})});function getStatus(){$(".automad-status").each(function(){var t=$(this),e=t.data("automadStatus");$.post("?ajax=status",{item:e},function(e){t.html(e.status)},"json")})}$(document).ready(function(){getStatus()}),$(document).ajaxComplete(function(t,e,a){"?ajax=status"!=a.url&&getStatus()}),$(document).on("keyup","textarea:visible",function(){var t=$(this),e=t.val().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />"),a=$("<div></div>").appendTo("body").hide().width(t.width()).html(e+" ").css({"white-space":"pre-wrap","word-wrap":"break-word","overflow-wrap":"break-word","font-family":t.css("font-family"),"font-size":t.css("font-size"),"line-height":t.css("line-height"),"letter-spacing":t.css("letter-spacing")});t.height(a.height()),a.remove()}),$(document).on("drop","textarea:visible",function(){setTimeout(function(){$("textarea").trigger("keyup")},50)}),$(document).ajaxComplete(function(){$("textarea").trigger("keyup")}),$(window).resize(function(){$("textarea").trigger("keyup")}),$(document).on("keydown","textarea",function(t){if(9===t.keyCode){var e=this.selectionStart,a=this.selectionEnd,o=$(this).val();$(this).val(o.substring(0,e)+"	"+o.substring(a)),this.selectionStart=this.selectionEnd=e+1,t.preventDefault()}}),$(document).on("click",'[data-target="#automad-upload-modal"]',function(){var t=$($(this).data("target")),e=t.data("automadUrl"),a=t.data("automadDropzoneText"),o=t.data("automadBrowseText"),n=t.find("#automad-upload").html(""),i=$('<div class="dropzone"><div class="text-muted">'+a+"</div></div>").appendTo(n),s=$('<input type="file" multiple />').appendTo(i).hide(),d=($('<button class="btn btn-primary"><span class="glyphicon glyphicon-folder-open"></span> '+o+"</button>").click(function(){return s.click(),!1}).insertAfter(i),t.find('[data-dismiss="modal"]'));$(document).on("drop dragover",function(t){t.preventDefault()});function r(t){return"number"!=typeof t?"":t>=1e9?(t/1e9).toFixed(2)+" gb":t>=1e6?(t/1e6).toFixed(2)+" mb":(t/1e3).toFixed(2)+" kb"}s.fileupload({url:"?ajax=upload",dataType:"json",dropZone:i,sequentialUploads:!0,singleFileUploads:!0,formData:[{name:"url",value:e}],add:function(t,e){var a="";$.each(e.files,function(t){a=a+'<h5><span class="badge">'+r(e.files[t].size)+"</span> "+e.files[t].name+"</h5>"}),e.context=$('<div class="box"></div>').appendTo(n),$(a).appendTo(e.context),$('<div class="progress progress-striped active"><div class="progress-bar"></div></div>').appendTo(e.context),e.context.find(".progress-bar").width("0px"),e.submit(),d.button("loading")},progress:function(t,e){var a=parseInt(e.loaded/e.total*100,10);e.context.find(".progress-bar").text(a+" %").animate({width:a+"%"},120)},stop:function(t){d.button("reset")},done:function(t,e){e.result.error?(e.context.find(".progress-bar").addClass("progress-bar-warning"),e.context.find(".progress").after('<div class="alert alert-warning">'+e.result.error+"</div>")):e.context.find(".progress-bar").addClass("progress-bar-success"),e.context.find(".progress").removeClass("progress-striped active")},fail:function(t,e){e.context.find(".progress-bar").text("Error").addClass("progress-bar-danger")}}),t.on("hidden.bs.modal",function(e){var a=t.closest("form");a.get(0).reset(),a.submit()}),t.modal({show:!0,backdrop:"static",keyboard:!1})});