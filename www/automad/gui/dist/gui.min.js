/*
 *	                  ....
 *	                .:   '':.
 *	                ::::     ':..
 *	                ::.         ''..
 *	     .:'.. ..':.:::'    . :.   '':.
 *	    :.   ''     ''     '. ::::.. ..:
 *	    ::::.        ..':.. .''':::::  .
 *	    :::::::..    '..::::  :. ::::  :
 *	    ::'':::::::.    ':::.'':.::::  :
 *	    :..   ''::::::....':     ''::  :
 *	    :::::.    ':::::   :     .. '' .
 *	 .''::::::::... ':::.''   ..''  :.''''.
 *	 :..:::'':::::  :::::...:''        :..:
 *	 ::::::. '::::  ::::::::  ..::        .
 *	 ::::::::.::::  ::::::::  :'':.::   .''
 *	 ::: '::::::::.' '':::::  :.' '':  :
 *	 :::   :::::::::..' ::::  ::...'   .
 *	 :::  .::::::::::   ::::  ::::  .:'
 *	  '::'  '':::::::   ::::  : ::  :
 *	            '::::   ::::  :''  .:
 *	             ::::   ::::    ..''
 *	             :::: ..:::: .:''
 *	               ''''  '''''
 *	
 *
 *	AUTOMAD GUI 
 *	
 *	version 16.07.27
 *
 *	Copyright (c) 2014-2016 by Marc Anton Dahmen
 *	http://marcdahmen.de
 *
 *	Licensed under the MIT license.
 *	http://automad.org/license
 */+function(t,a){t.addVariable={selectors:{container:"#automad-add-variable-container",modal:"#automad-add-variable-modal",modalInput:"#automad-add-variable-input",submit:"#automad-add-variable-submit"},dataAttr:{errorName:"data-automad-error-name",errorExists:"data-automad-error-exists"},append:function(e){var o=t.addVariable,n=t.util,r=a(e.target),i=a(o.selectors.container),d=a(o.selectors.modalInput),u="automad-input-data-",s=d.val().replace(/[^\w\.\-]/g,"_").toLowerCase();0==a("#"+u+s).length?s?a.post("?ajax=add_variable",{name:s},function(t){UIkit.modal(o.selectors.modal).hide(),d.val(""),i.append(t),a("#"+u+s).focus()}):t.notify.error(r.data(n.dataCamelCase(o.dataAttr.errorName))):t.notify.error(r.data(n.dataCamelCase(o.dataAttr.errorExists)))}},a(document).on("click",t.addVariable.selectors.submit,t.addVariable.append)}(window.Automad=window.Automad||{},jQuery),+function(t,a){t.autocomplete={submitForm:function(t){t.preventDefault();var e=a(t.target).closest("form");setTimeout(function(){e.submit()},50)}},a(document).on("keydown",".uk-autocomplete > input",function(a){13==a.which&&t.autocomplete.submitForm(a)}),a(document).on("click",".uk-form .uk-dropdown a",t.autocomplete.submitForm)}(window.Automad=window.Automad||{},jQuery),+function(t,a){t.form={unsavedClassPrefix:"automad-unsaved-",dataAttr:{handler:"data-automad-handler",url:"data-automad-url",submit:"data-automad-submit",init:"data-automad-init",autoSubmit:"data-automad-auto-submit",close:"data-automad-close-on-success",confirm:"data-automad-confirm",enter:"data-automad-enter",defaultValue:"data-automad-default"},ajaxPost:function(e){var o=t.form,n=o.dataAttr,r=a(e.target),i=r.data(t.util.dataCamelCase(o.dataAttr.handler)),d=r.data(t.util.dataCamelCase(o.dataAttr.url));r.find("["+n.defaultValue+"]").each(function(){var e=a(this);e.val()||e.val(e.data(t.util.dataCamelCase(n.defaultValue)))});var u=r.serializeArray();d&&u.push({name:"url",value:d}),a.post("?ajax="+i,u,function(a){if(a.debug&&console.log(a.debug),a.redirect&&(window.location.href=a.redirect),a.html&&r.html(a.html),a.error&&t.notify.error(a.error),a.success&&t.notify.success(a.success),!a.error){var e=r.data(t.util.dataCamelCase(o.dataAttr.close));e&&UIkit.modal(e).hide()}},"json")},confirm:function(e){e.preventDefault();var o=t.form,n=a(e.target),r=n.data(t.util.dataCamelCase(o.dataAttr.confirm));r&&n.find("input").length>0?UIkit.modal.confirm(r,function(){o.ajaxPost(e)}):o.ajaxPost(e)},init:function(){var e=a(document),o=t.form,n=o.dataAttr;e.on("submit","["+n.handler+"]",o.confirm),e.on("click","["+n.submit+"]",function(e){var o=a(this).data(t.util.dataCamelCase(n.submit));e.preventDefault(),a("form["+n.handler+'="'+o+'"]').submit()}),e.ready(function(){a("["+t.form.dataAttr.init+"]").trigger("submit")}),e.on("ready ajaxComplete",o.modalEvents),e.on("keydown","["+n.handler+"] input",function(t){13==t.which&&t.preventDefault()}),e.on("keydown","["+n.enter+"]",function(e){if(13==e.which){var o=a(e.target).data(t.util.dataCamelCase(n.enter));a(o).click()}}),e.on("change drop","["+n.autoSubmit+"] input, ["+n.autoSubmit+"] textarea",function(t){a(t.target).closest("form").submit()}),e.on("ready",function(){a("button["+n.submit+"]").prop("disabled",!0)}),e.on("ajaxComplete",function(t,e,o){var r=o.url.replace("?ajax=","");a("button["+n.submit+'="'+r+'"]').prop("disabled",!0)}),e.on("change drop","["+n.handler+"]:not(["+n.autoSubmit+"]) input, ["+n.handler+"]:not(["+n.autoSubmit+"]) textarea",function(){var e=a(this).closest("["+n.handler+"]"),r=e.data(t.util.dataCamelCase(n.handler));a("html").addClass(o.unsavedClassPrefix+r),a("button["+n.submit+'="'+r+'"]').prop("disabled",!1)}),e.on("submit","["+n.handler+"]",function(){var e=a(this).data(t.util.dataCamelCase(n.handler));a("html").removeClass(o.unsavedClassPrefix+e)}),window.onbeforeunload=function(){return a('html[class*="automad-unsaved-"]').length?"You have unsaved chages!":void 0}},modalEvents:function(){var e=a(".uk-modal");e.off("show.uk.modal.automad.form"),e.off("hide.uk.modal.automad.form"),e.on({"show.uk.modal.automad.form":function(){a(this).find("["+t.form.dataAttr.init+"]").each(function(){a(this).empty().submit()}),a(this).find("input:not(:disabled)").first().focus()},"hide.uk.modal.automad.form":function(){a(this).find("form").each(function(){var e=a(this).data(t.util.dataCamelCase(t.form.dataAttr.handler));a("html").removeClass(t.form.unsavedClassPrefix+e),this.reset()})}})}},t.form.init()}(window.Automad=window.Automad||{},jQuery),+function(t){t(document).ready(function(){t("#automad-no-js").remove()})}(jQuery),+function(t,a){t.notify={error:function(t){UIkit.notify(t,{timeout:1e4,pos:"top-right",status:"danger"})},success:function(t){UIkit.notify(t,{timeout:3e3,pos:"top-right",status:"success"})}}}(window.Automad=window.Automad||{},jQuery),+function(t){t(document).on("click",".automad-remove-parent",function(){var a=t(this).parent();a.find("input, textarea").trigger("change"),a.remove()})}(jQuery),+function(t,a){t.renameFile={selectors:{modal:"#automad-rename-file-modal",button:"#automad-rename-file-submit"},$modal:"",$parentForm:"",inputs:{$old:a("<input>",{type:"text",name:"old-name","class":"uk-form-controls uk-width-1-1"}).prop("disabled",!0),$new:a("<input>",{type:"text",name:"new-name","class":"uk-form-controls uk-width-1-1 uk-margin-small-top"}),init:function(e){var o=t.renameFile;o.$modal=a(o.selectors.modal),o.$parentForm=o.$modal.closest("form");var n=o.$modal.find(".uk-modal-header"),r=a(e.target).data("automadFile");o.inputs.$old.insertAfter(n).val(r),o.inputs.$new.insertAfter(o.inputs.$old).focus().val(r),o.inputs.$new.attr(t.form.dataAttr.enter,t.renameFile.selectors.button),o.$modal.off("hide.uk.modal.automad.renameFile"),o.$modal.on("hide.uk.modal.automad.renameFile",o.inputs.destroy)},destroy:function(){t.renameFile.inputs.$old.remove(),t.renameFile.inputs.$new.remove()},submit:function(e){var o=t.renameFile,n=a(e.target),r={url:o.$modal.data("automadUrl"),"old-name":o.inputs.$old.val(),"new-name":o.inputs.$new.val()};n.prop("disabled",!0),a.post("?ajax=rename_file",r,function(a){n.prop("disabled",!1),a.error?t.notify.error(a.error):(UIkit.modal(o.selectors.modal).hide(),o.$modal.on("hide.uk.modal.automad.renameFile",function(){o.inputs.destroy(),o.$parentForm.empty().submit()}))},"json")}}},a(document).on("click",'a[href="'+t.renameFile.selectors.modal+'"]',t.renameFile.inputs.init),a(document).on("click",t.renameFile.selectors.button,t.renameFile.inputs.submit)}(window.Automad=window.Automad||{},jQuery),+function(t,a){t.scrollbars={defaults:{scrollToItem:!1},dataAttr:"data-automad-scroll-box",init:function(){var e=t.scrollbars,o=t.util;a("["+e.dataAttr+"]").each(function(){var t=a(this),n=t.data(o.dataCamelCase(e.dataAttr)),r=a.extend({},e.defaults,n);if(t.mCustomScrollbar({scrollbarPosition:"outside",theme:"minimal-dark",autoHideScrollbar:!0,scrollInertia:50,scrollButtons:{enable:!1}}),r.scrollToItem){var i=t.find(r.scrollToItem);i.length&&setTimeout(function(){i.offset().top+80>a(window).height()&&t.mCustomScrollbar("scrollTo",function(){return i.offset().top-a(window).height()+80},{scrollInertia:200})},50)}})}},a(document).ready(t.scrollbars.init)}(window.Automad=window.Automad||{},jQuery),+function(t,a){t.siteTree={"class":{active:"uk-active",iconOpen:"automad-tree-icon-open",iconClose:"automad-tree-icon-close",toggle:"automad-tree-toggle"},dataAttr:"data-automad-tree",urlAsValue:function(e,o){var n=t.siteTree,r=e.find('a[href^="?"]');r.click(function(t){t.preventDefault();var r=a(this),i=decodeURIComponent(r.attr("href").split("=")[1]);e.find("."+n["class"].active).removeClass(n["class"].active),r.parent().addClass(n["class"].active),o.val(i).trigger("change")})},init:function(){var e=t.siteTree,o=a("["+e.dataAttr+"]");o.each(function(){var o=a(this),n=o.data(t.util.dataCamelCase(e.dataAttr));o.find("li li").has("ul").each(function(){var t=a(this),o=t.children("ul"),n=a("<a></a>",{"class":e["class"].toggle,href:"#"}).prependTo(t),r=a("<i></i>").prependTo(n);t.hasClass(e["class"].active)||t.find("."+e["class"].active).length>0?r.addClass(e["class"].iconClose):(r.addClass(e["class"].iconOpen),o.hide()),n.click(function(t){t.preventDefault(),o.toggle(),r.toggleClass(e["class"].iconOpen+" "+e["class"].iconClose)})}),n&&e.urlAsValue(o,a(n))})}},a(document).ready(t.siteTree.init)}(window.Automad=window.Automad||{},jQuery),+function(t,a){t.status={dataAttr:"data-automad-status",get:function(){var e=t.status;a("["+e.dataAttr+"]").each(function(){var o=a(this),n=o.data(t.util.dataCamelCase(e.dataAttr));a.post("?ajax=status",{item:n},function(t){o.html(t.status)},"json")})},init:function(){var e=a(document),o=t.status;e.ready(function(){o.get()}),e.ajaxComplete(function(t,a,e){"?ajax=status"!=e.url&&o.get()})}},t.status.init()}(window.Automad=window.Automad||{},jQuery),+function(t,a){t.textarea={handleTabs:function(t){if(9===t.keyCode){t.preventDefault();var e=this.selectionStart,o=this.selectionEnd,n=a(t.target),r=n.val();n.val(r.substring(0,e)+"	"+r.substring(o)),this.selectionStart=this.selectionEnd=e+1}},init:function(){var e=t.textarea,o=a(document);o.on("keyup focus focusout update.automad.textarea","textarea",e.resize),o.on("drop cut paste","textarea",function(t){var e=a(t.target);setTimeout(function(t){e.trigger("update.automad.textarea")},50)}),o.ajaxComplete(function(){a("textarea").trigger("update.automad.textarea")}),a(window).resize(function(){a("textarea").trigger("update.automad.textarea")}),o.on("keydown","textarea",e.handleTabs)},resize:function(t){var e=a(t.target),o=e.val().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />"),n=30,r=a("<div></div>").appendTo("body").hide().width(e.width()).html(o+" ").css({"white-space":"pre-wrap","word-wrap":"break-word","overflow-wrap":"break-word","font-family":e.css("font-family"),"font-size":e.css("font-size"),"line-height":e.css("line-height"),"letter-spacing":e.css("letter-spacing")});"focusout"!=t.type&&"update"!=t.type||(n=0),e.height(r.height()+n),r.remove()}},t.textarea.init()}(window.Automad=window.Automad||{},jQuery),+function(t,a){t.toggle={labelDataAttr:"data-automad-toggle",activeClass:"uk-active",checkbox:function(e){t.toggle.update(a(e.target))},init:function(){a("["+t.toggle.labelDataAttr+"] input").each(function(){t.toggle.update(a(this))})},radio:function(e){a('input[name="'+a(e.target).attr("name")+'"]').each(function(){t.toggle.update(a(this))})},update:function(e){var o=t.toggle.activeClass,n=e.parent(),r=n.data(t.util.dataCamelCase(t.toggle.labelDataAttr));if(e.is(":checked")?n.addClass(o):n.removeClass(o),r){var i=a(r);e.is(":checked")?i.show():i.hide()}}},a(document).on("change","["+t.toggle.labelDataAttr+'] [type="checkbox"]',t.toggle.checkbox),a(document).on("change","["+t.toggle.labelDataAttr+'] [type="radio"]',t.toggle.radio),a(document).on("ready ajaxComplete",t.toggle.init)}(window.Automad=window.Automad||{},jQuery),+function(t,a){t.upload={selectors:{modal:"#automad-upload-modal",container:"#automad-upload-container"},$modal:"",$container:"",$close:"",page:"",$dropzone:a("<div></div>",{"class":"automad-files-dropzone"}),$input:a('<input type="file" multiple />'),$browse:a("<button></button>",{"class":"uk-button uk-button-primary uk-width-1-1 uk-margin-top"}).click(function(){return t.upload.$input.click(),!1}),init:function(e){var o=t.upload;o.$modal=a(o.selectors.modal),o.$container=a(o.selectors.container).empty(),o.page=o.$modal.data("automadUrl"),o.$dropzone.text(o.$modal.data("automadDropzoneText")).appendTo(o.$container),o.$input.appendTo(o.$dropzone).hide(),o.$browse.text(o.$modal.data("automadBrowseText")).insertAfter(o.$dropzone),o.$close=o.$modal.find(".uk-modal-close"),o.plugin(),a(o.selectors.modal).on("hide.uk.modal",{$filesForm:o.$modal.closest("form")},o.refresh)},plugin:function(){var e=t.upload;e.$input.fileupload({url:"?ajax=upload",dataType:"json",dropZone:e.$dropzone,sequentialUploads:!0,singleFileUploads:!0,formData:[{name:"url",value:e.page}],add:function(o,n){var r="<hr>";a.each(n.files,function(a){r+='<div class="uk-margin-small-bottom uk-text-truncate"><span class="uk-badge uk-badge-notification">'+t.util.formatBytes(n.files[a].size)+"</span>&nbsp;&nbsp;"+n.files[a].name+"</div>"}),n.context=a("<div></div>",{"class":"uk-margin-large-top uk-margin-large-bottom"}).appendTo(e.$container),a(r).appendTo(n.context),a('<div class="uk-progress uk-progress-striped uk-active"><div class="uk-progress-bar"></div></div>').appendTo(n.context),n.context.find(".uk-progress-bar").width("0px"),n.submit(),e.$close.prop("disabled",!0),e.$close.find("i").removeClass("uk-icon-close").addClass("uk-icon-circle-o-notch uk-icon-spin")},progress:function(t,a){var e=parseInt(a.loaded/a.total*100,10);a.context.find(".uk-progress-bar").text(e+" %").width(e+"%")},stop:function(t){e.$close.prop("disabled",!1),e.$close.find("i").addClass("uk-icon-close").removeClass("uk-icon-circle-o-notch uk-icon-spin")},done:function(t,a){a.context.find(".uk-progress").removeClass("uk-progress-striped uk-active"),a.result.error?(a.context.find(".uk-progress").addClass("uk-progress-warning"),a.context.find(".uk-progress").after('<div class="uk-alert uk-alert-warning">'+a.result.error+"</div>")):a.context.find(".uk-progress").addClass("uk-progress-success")},fail:function(t,a){a.context.find(".uk-progress").addClass("uk-progress-danger"),a.context.find(".uk-progress-bar").text("Error")}})},refresh:function(t){t.data.$filesForm.empty().submit()}},a(document).on("click",'[href="'+t.upload.selectors.modal+'"]',t.upload.init),a(document).on("drop dragover",t.upload.selectors.modal,function(t){t.preventDefault()})}(window.Automad=window.Automad||{},jQuery),+function(t,a){t.util={dataCamelCase:function(t){return t=t.replace(/data-/g,""),t=t.replace(/\-[a-z]/g,function(t){return t.charAt(1).toUpperCase()})},formatBytes:function(t){return"number"!=typeof t?"":t>=1e9?(t/1e9).toFixed(2)+" gb":t>=1e6?(t/1e6).toFixed(2)+" mb":(t/1e3).toFixed(2)+" kb"}}}(window.Automad=window.Automad||{},jQuery);